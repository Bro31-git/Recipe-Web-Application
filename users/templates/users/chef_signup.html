{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Chef Sign-Up</title>
  <style>
    :root {
      --bg: linear-gradient(0deg, #e5fdf3, #e7edfe, #ffecf8);
      --card-bg: rgba(255, 255, 255, 0.55);
      --input-bg: rgba(255, 255, 255, 0.4); 
      --muted: #777;
      --accent: #a9f2c9c1; 
      --notice: #49ab73;
      --btn-login: #d88474;
      --orange: #f6a079;
      --dark-orange: #a66445;
      --danger: #ad2f2bd8;
      --light: #ffffff;
    }
    * {
      box-sizing: border-box;
    }
    
    html,
    body {
      height: 100%;
    }
    
    body {
      min-height: 100vh; 
      width: 100%;
      overflow-y: auto;  
      margin: 0;
      font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      display: flex;
      position: relative;
      cursor: default;
      align-items: center;
      justify-content: center;
      padding: 40px 20px;
    }
    body::before {
      content: "";
      position: fixed; 
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      background-image: linear-gradient(to bottom, rgba(0,0,0,0.5), rgba(0,0,0,0.7)), url("{% static 'users/icons/pexels-farhad.jpg' %}");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      /* Hardware acceleration trick to stop shaking */
      will-change: transform;
}
    
    @keyframes fadeInDown {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
    
      }
    }
    
    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 0.6;
        transform: translateY(0);
      }
    }
    
    .container {
      display: flex;
      width: 100%;
      max-width: 920px;
      position: relative; /* needed for overlay */
      border-radius: 15px;
      -webkit-backdrop-filter: blur(6px) saturate(120%);
      backdrop-filter: blur(6px) saturate(120%);
      border-color: var(--orange) !important;
      box-shadow: 0 0 0 7px rgba(217, 83, 79, 0.1) !important;
    }
    
    .container, .section-greeting-img .box{ 
      border-radius: 15px; 
    }
    
    /* dark overlay so text is readable (70% darkness) */
    .container::before{
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 15px;
      background: rgba(0, 0, 0, 0.42);
      z-index: 0;
    }
    
    .section-greeting-img {
      /* larger visual section on the left with transparent background so container image shows */
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: flex-start;
      padding: 28px;
      color: #fff;
      border-radius: 15px;
    }
    
    .section-greeting-img h1 {
      align-self: center;
      font-size: 36px;
      font-family: "Inter", sans-serif;
      margin: 0 0 8px 0;
      color: #fff;
    }
    
    .section-greeting-img h2 {
      align-self: center;
      font-family: "Inter", sans-serif;
      margin: 0;
      color: #fff;
    }
    
    /* make greeting area wider than the form */
    .section-greeting-img{
      flex: 1.4;
    }
    .section-card{
      flex: 1.6;
    }
    
    input[type="checkbox"]{
      accent-color: var(--orange);
    }
    
    .section-greeting-img, .section-card{
      position: relative;
      z-index: 1;
    }
    
    /* ===== Card Container ===== */
    .box {
      padding: 30px 35px;
      position: relative; /* sit above overlay */
      z-index: 1;
    }

    .section-greeting-img .box {
      border-radius: 12px;
    }
    
    .section-card {
      margin: 2.8px;
      background: rgba(248, 237, 230, 0.92);
      border-radius: 0 15px 15px 0;
    }
    .section-card h1 {
      margin: 0 0 10px 0;
      text-align: center;
      font-size: 28px;
      color: #494646;
    }
    
    .error-notice p {
      color: var(--danger); 
      font-size: 13px;
    }

    /* ===== Form Fields ===== */
    .field {
      margin-bottom: 16px;
    }
    
    .field .username {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    
        /* 1. Hide the default browser eye icon */
    input::-ms-reveal,
    input::-ms-clear {
        display: none;
    }

    /* 2. Style the password wrapper */
    .pw-wrap {
        position: relative;
        display: flex;
        align-items: center;
    }

    /* 3. Style the toggle button */
    .pw-toggle {
        position: absolute;
        right: 10px;
        background: transparent;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        padding: 0;
        z-index: 5;
    }

    .pw-toggle img {
        width: 20px; /* Adjust as needed */
        height: auto;
    }

    /* 4. Ensure input doesn't hide text under the icon */
    .pw-wrap input {
        padding-right: 40px;
        width: 100%;
    }

    .show-hide {
      z-index: 1000;
      border-radius: 50%;
      border: 2px solid var(--light);
      background: var(--light);
      animation: fadeInDown 2s ease-out 0.2s backwards;  
    }
    .show-hide:focus {
      transform: rotateX(0);
    }
    
    .show-hide:active {
      transition: transform 0.4s;
      transform: rotate(-180deg);
    }

    .visually-hidden { 
      position: absolute !important;
      height: 1px; 
      width: 1px;
      overflow: hidden;
      clip: rect(1px,1px,1px,1px);
      white-space: nowrap; 
      border: 0; 
      padding: 0; 
      margin: -1px; 
    }
    
    .field label {
      color: #312d2d;
      display: block;
      margin-bottom: 4px;
      font-size: 13.7px;
      font-weight: normal;
      animation: fadeInDown 0.7s ease-out 0.2s backwards;
    }
    
    .field input[type="text"],
    .field input[type="email"],
    .field input[type="password"],
    .field input[type="number"] {
      width: 100%;
      padding: 10px 12px;
      border-radius: 3px;
      border: 2px solid var(--light);
      background: var(--light);
      outline: none;
      cursor: pointer;
      font-size: 13px;
      font-family: "Inter", sans-serif;
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px); 
      transition: ease 0.5s;
      animation: fadeInDown 2s ease-out 0.2s backwards;
    }
    
    .field input:focus, .field input:hover {
      background: var(--light);
      border-color: var(--orange);
      box-shadow: 0 0 0 5px rgba(246, 160, 121, 0.2);
    }
    
    .hint {
      display: block;
      margin-top: 6px;
      color: var(--muted);
      font-size: 11px;
    }
    .pw {
      cursor: pointer;
    }
    
    /* label icons (placed before the label text) */
    .label-icon{
      width: 16px;
      height: 16px;
      display: inline-block;
      vertical-align: middle;
      margin-right: 8px;
      margin-bottom: 4px;
    }
    
    
    /* ===== Checkbox Field ===== */
    .checkbox-field {
      display: flex;
      align-items: center;
      margin: 28px 0;
      gap: 10px;
    }
    
    #agree {
      cursor: pointer;
    }
    
    .checkbox-field .notice {
      color: var(--dark-orange);
    }
    
    .checkbox-field a {
      text-decoration: none;
      font-weight: normal;
      color: var(--dark-orange);
    }
    
    .checkbox-field input[type="checkbox"] {
      width: 16px;
      height: 16px;
    }
    
    /* ===== Buttons ===== */
    button[type="submit"] {
      width: 100%;
      padding: 12px 16px;
      border-radius: 10px;
      border: none;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      background: linear-gradient(180deg,var(--btn-login), #c9655a);
      color: #fff;
      transition: all 0.3s ease;
    }
    
    button[type="submit"]:hover {
      background: linear-gradient(180deg,var(--btn-login), #c9655a);
      border-color: var(--orange);
      box-shadow: 0 0 0 5px rgba(246, 160, 121, 0.2);
    }
    
    button[disabled] {
      opacity: 0.6;
      cursor: not-allowed;
      animation: slideInUp 0.6s ease-out 0.4s backwards;
    }
    
    .login-opt {
      display: flex;
      margin: 10px 0 0 0;
      justify-content: space-around;
    }
    
    .login-opt p {
      margin-left: 0;
      color: #000;
      font-size: 13px;
      font-weight: normal;
    }
    
    .login-opt a {
      text-decoration: none;
      color: var(--dark-orange);
      transition: transform 1s;
    }
    
    .login-opt .login {
      font-family: Arial, Helvetica, sans-serif;
      font-size: 18px;
      font-weight: normal;
      text-align: center;
      align-content: center;
    }
    .login:hover {
      border-color: var(--orange);
      text-shadow: 5px rgba(246, 160, 121, 0.2);
    }

    .username .field {
      flex: 1;
    }
    
    /* ===== Three Column Layout ===== */
    .three-col {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px;
    }
    
    .three-col .field {
      flex: 1;
    }
    
    /* ===== Validation Classes ===== */
    
    .input-invalid {
      border-color: var(--danger) !important;
      box-shadow: 0 0 0 7px rgba(217, 83, 79, 0.1) !important;
    }
    
    
    /* ===== Responsive Design ===== */
    @media (max-height: 890px) {
  html, body {
    min-height: 100vh;
    height: auto;
  }
  
  body {
    background-image: linear-gradient(to bottom, rgba(0,0,0,0.5), rgba(0,0,0,0.6)), url('pexels-farhad.jpg');
    padding: 12px; /* reduce padding */
    align-items: center;
    overflow: hidden;
    justify-content: center;
  }

  /* Resize container */
  .container { 
    max-width: 880px;/* smaller width */
    min-height: 450px; /* reduce height */
  }

  /* Greeting section */
  .section-greeting-img {
    padding: 15px;
    font-size: 0.9rem;
    flex: 1; /* adjust height proportion */
  }

  /* Card section */
  .section-card {
    padding: 18px 25px;
    flex: 1; /* adjust height proportion */
    border-radius: 12px;
  }

  /* Inputs resize */
  .field input[type="text"],
  .field input[type="email"],
  .field input[type="password"],
  .field input[type="number"] {
    padding: 10px 12px;
    font-size: 12px;
  }

  select {
    padding: 8px 10px;
    font-size: 12px;
  }

  /* Buttons resize */
  button[type="submit"] {
    padding: 10px;
    font-size: 14px;
  }

  /* Optional: reduce image/logo sizes */
  .label-icon {
    width: 14px;
    height: 14px;
  }
}
    @media (max-width: 900px) {
      html,
    body {
      min-height: 100vh;
      height: auto;
    }
      body {
        background-image: linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(0,0,0,0.75)), url('pexels-farhad.jpg');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        padding: 24px;
        overflow: scroll;
      }
      /* stack sections vertically and let the background show through */
      .container { 
        flex-direction: column; 
        max-width: 600px; 
        
      }
      
      .section-greeting-img { 
        border-radius: 15px 15px 0 0; 
        padding: 20px; 
        background-position-y: bottom;
      }
      .section-card { 
        border-radius: 15px; 
        margin-top: -12px; 
        background: rgba(248, 237, 230, 0.92); 
      }
      .container::before { 
        background: rgba(0,0,0,0.18); 
      }
    
      .section-greeting-img h1 { 
        transform: translateY(-8px); 
        font-size: 28px; 
      }
      .section-greeting-img h2 { 
        transform: translateY(-4px); 
        font-size: 15px; 
      }
    
      .two-col { 
        display: block; 
      }
      .username { 
        grid-template-columns: 1fr; 
      }
    }
    
    @media (max-width: 420px) {
      html,
    body {
      min-height: 100vh;
      height: auto;
    }
      body{
        margin: 0;
        padding: 0;
        overflow: scroll;
      }
      .container {
        margin: 20% 0 0 0;
        -webkit-backdrop-filter: blur(2px) saturate(120%);
        backdrop-filter: blur(2px) saturate(120%);
      }
      
      .container::before{
        content: '';
        background: rgba(0, 0, 0, 0.237);
        z-index: 0;
      }
    
      .box {
        padding: 30px 35px;
        -webkit-backdrop-filter: blur(1px);
        backdrop-filter: blur(1px);
      }
      
      .section-greeting-img h1 { 
        font-size: 25px;
      }
      .section-greeting-img h2 { 
        font-size: 18px; 
      }
      .section-card {  
        margin: 0;
        padding: 18px 18px 28px 18px; 
        border-radius: 15px 15px 0 0;
        border-color: transparent !important;
        box-shadow: none !important;
      }
      
     .field label {
        font-size: 12.7px;
     }
      
     .field input[type="text"],
     .field input[type="email"],
     .field input[type="password"],
     .field input[type="number"] {
       padding: 12px 14px;
       font-size: 13px;
     }
     select {
      padding: 12px 14px;
    }
     .pw-toggle img { 
       width: 15px; 
       height: 15px; 
     }
     .label-icon{
       width: 16px;
       height: 16px;
     }
    
    }
    </style>
</head>
<body>
  <main class="container">
   <div class="section-greeting-img box">
  <h1>HI, Welcome Chef!</h1>
  <h2>Sign Up to get Started</h2>
</div>

    <div class="section-card box">
      <form id="signupForm" method="POST" action="{% url 'chef-signup' %}" novalidate>
        {% csrf_token %} <h1>Chef Sign Up</h1>

      {% if form.errors %}
        <div class="error-notice">
           <p>Please fix the errors below.</p>
        </div>
      {% endif %}  

      <div class="row two-col">
        <div class="field">
          <label for="firstName"><img class="label-icon" src="{% static 'users/icons/user.svg' %}" alt="">Username</label>
          <div class="username">
            <input id="firstName" name="first_name" type="text" placeholder="First name" required autocomplete="given-name" value="{{ form.first_name.value|default:'' }}"/>
            <input id="lastName" name="last_name" type="text" placeholder="Last name" required autocomplete="family-name" value="{{ form.last_name.value|default:'' }}"/>
          </div>
          {{ form.first_name.errors }}
        </div>
      </div>

      <div class="field">
        <label for="username"><img class="label-icon" src="{% static 'users/icons/user.svg' %}" alt="">Username</label>
        <input id="username" name="username" type="text" placeholder="Choose a unique username" required autocomplete="username" value="{{ form.username.value|default:'' }}"/>
        {{ form.username.errors }}
      </div>

      <div class="field">
        <label for="email"><img class="label-icon" src="{% static 'users/icons/mail.png' %}" alt="">Email</label>
        <input id="email" name="email" type="email" placeholder="Enter a valid email" required autocomplete="email" value="{{ form.email.value|default:'' }}"/>
        {{ form.email.errors }}
      </div>

      <div class="field">
        <label for="password"><img class="label-icon" src="{% static 'users/icons/locked-computer.png' %}" alt="">Password</label>
        <div class="pw-wrap">
          <input id="password" name="password1" type="password" placeholder="Enter your password" autocomplete="new-password" required />
          <button type="button" class="pw-toggle" aria-label="Show password">
            <img src="{% static 'users/icons/view.png' %}" class="show-hide" alt="Show"/>
            <span class="visually-hidden">Show password</span>
          </button>
        </div>
        <small class="hint pw">Password length must be &gt; 6 and &lt; 23 characters.</small>
        {{ form.password1.errors }}
      </div>

      <div class="field">
        <label for="confirm"><img class="label-icon" src="{% static 'users/icons/locked-computer.png' %}" alt="">Confirm password</label>
        <div class="pw-wrap">
          <input id="confirm" name="password2" type="password" placeholder="Re-enter your password" autocomplete="new-password" required />
          <button type="button" class="pw-toggle" aria-label="Show confirm password">
            <img src="{% static 'users/icons/view.png' %}" class="show-hide" alt="Show"/>
            <span class="visually-hidden">Show confirm password</span>
          </button>
        </div>
      </div>
      
       <div class="field">
        <label for="years"><img class="label-icon" src="{% static 'users/icons/calendar.svg' %}" alt="">Years of experience</label>
        <input id="years" name="years" type="number" required min="0" step="1" placeholder="This field is optional." />
        {{ form.years_of_experience.errors }}
      </div>

      <div class="field checkbox-field">
        <input id="agree" name="agree" type="checkbox" />
        <label for="agree">I agree to the <a href="{% url 'terms-chef' %}" target="_blank" class="notice">Terms of Service</a> and <a href="{% url 'terms-chef' %}" target="_blank" class="notice">Privacy Police</a></label>
      </div>

      <button id="createBtn" type="submit" disabled>Create account</button>

     <div class="login-opt">
       <p>Already have an account?</p>
       <a href="{% url 'login' %}" class="login">Login</a> 
     </div>

    </form>
    </div>
  </main>

  <script>// ===== DOM ELEMENTS =====
    const form = document.getElementById('signupForm');
    const firstName = document.getElementById('firstName');
    const lastName = document.getElementById('lastName');
    const username = document.getElementById('username'); 
    const email = document.getElementById('email');
    const years = document.getElementById('years');
    const password = document.getElementById('password');
    const confirm = document.getElementById('confirm');
    const agree = document.getElementById('agree');
    const createBtn = document.getElementById('createBtn');
    
    // ===== PASSWORD VISIBILITY TOGGLES =====
    function initPasswordToggles() {
        const toggles = document.querySelectorAll('.pw-toggle');
        const viewSrc = "{% static 'users/icons/view.png' %}";
        const hideSrc = "{% static 'users/icons/hide.png' %}";
    
        toggles.forEach(btn => {
            const input = btn.parentElement.querySelector('input');
            const img = btn.querySelector('img');
    
            btn.addEventListener('click', (e) => {
                e.preventDefault(); // Prevents "Eye" click from submitting form
                const isPassword = input.type === 'password';
                input.type = isPassword ? 'text' : 'password';
                img.src = isPassword ? hideSrc : viewSrc;
            });
        });
    }
    
    // ===== VALIDATION HELPERS =====
    const setValid = (el) => { el.classList.add('input-valid'); el.classList.remove('input-invalid'); };
    const setInvalid = (el) => { el.classList.add('input-invalid'); el.classList.remove('input-valid'); };
    const setNeutral = (el) => { el.classList.remove('input-invalid', 'input-valid'); };
    
    function validateEmail() {
        const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        const ok = regex.test(email.value);
        if (email.value.length === 0) { setNeutral(email); return false; }
        ok ? setValid(email) : setInvalid(email);
        return ok;
    }
    
    function validatePasswordLength() {
        const ok = password.value.length > 6 && password.value.length < 23;
        if (password.value.length === 0) { setNeutral(password); return false; }
        ok ? setValid(password) : setInvalid(password);
        return ok;
    }
    
    function validateConfirmMatch() {
        const ok = confirm.value === password.value && confirm.value.length > 0;
        if (confirm.value.length === 0) { setNeutral(confirm); return false; }
        ok ? setValid(confirm) : setInvalid(confirm);
        return ok;
    }
    
    /**
     * OPTIONAL FIELD LOGIC
     * Returns true if empty (allowed) OR if the number is valid.
     */
    function validateYears() {
        const val = years.value.trim();
        if (val === "") {
            setNeutral(years);
            return true; // Valid because it is optional
        }
        const num = Number(val);
        const ok = num >= 0 && num < 100;
        ok ? setValid(years) : setInvalid(years);
        return ok;
    }
    
    // ===== CORE FORM VALIDITY CHECK =====
    function checkFormValidity() {
        const isFirstName = firstName.value.trim().length > 0;
        const isLastName = lastName.value.trim().length > 0;
        const isUsername = username.value.trim().length > 0;
        const isEmail = validateEmail();
        const isPass = validatePasswordLength();
        const isMatch = validateConfirmMatch();
        const isYearsOk = validateYears(); // Now handles optional state
        const isAgreed = agree.checked;
    
        const allValid = isFirstName && isLastName && isUsername && isEmail && isPass && isMatch && isYearsOk && isAgreed;
        
        createBtn.disabled = !allValid;
        return allValid;
    }
    
    // ===== EVENT LISTENERS =====
    
    [firstName, lastName, username, email, years, password, confirm, agree].forEach(el => {
        el.addEventListener('input', () => {
            if ([firstName, lastName, username].includes(el)) {
                el.value.trim().length > 0 ? setValid(el) : setNeutral(el);
            }
            checkFormValidity();
        });
    });
    
    // Navigation (Enter Key)
    const inputs = [firstName, lastName, username, email, years, password, confirm];
    inputs.forEach((input, index) => {
        input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                const next = inputs[index + 1];
                if (next) next.focus();
                else agree.focus();
            }
        });
    });
    
    // ===== AJAX SUBMISSION (Try/Catch) =====
    form.addEventListener('submit', (event) => {
      
        if (!checkFormValidity()) {
            event.preventDefault();
            alert("Please complete the form correctly.");
        }
      
    });
    initPasswordToggles();
    checkFormValidity();
  </script>
</body>
</html>
