{% extends 'users/base.html' %}
{% load static %}

{% block extra_css %}
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&family=Lobster&display=swap" rel="stylesheet">

 <style>
    :root {
        --bg: #7a7a7a;
        --card: rgba(248, 237, 230, 0.96);
        --accent: #f6a079;
        --btn-login: #d88474;
        --light-orange: #fff4e6;
        --orange: #f6a079;
        --text: #333;
        --muted: #625e5e;
        --light: #ffffff;
    }

    * {
        box-sizing: border-box;
        font-family: 'Poppins', system-ui, sans-serif;
    }

    /* --- BACKGROUND --- */
    .bg {
        position: fixed;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        z-index: -1;
        pointer-events: none;
    }

    /* --- FORM SECTION --- */
    #formSection {
        position: relative;
        width: 100%;
        max-width: 760px;
        margin: 10px auto;
        padding: 20px;
        z-index: 10;
        transition: all 0.4s ease-in-out;
        display: none;
        opacity: 0;
        transform: translateY(20px);
    }

    #formSection.active {
        display: block;
        opacity: 1;
        transform: translateY(0);
        animation: fadeIn 0.5s forwards;
    }

    @keyframes fadeIn {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .flex-option {
      justify-content: space-between;
      align-items: center;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin: 20px 0 15px 0;
    }

    /* --- RECOM SECTION --- */
    #recomSection {
        position: relative;
        width: 100%;
        max-width: 900px;
        margin: 0 auto;
        height: 85vh;
        overflow-y: auto;
        padding: 20px 10px 100px 10px;
        z-index: 20;
        display: none;
        border-radius: 10px;
    }

    #recomSection::-webkit-scrollbar {
        width: 8px;
    }

    #recomSection::-webkit-scrollbar-track {
        background: transparent;
    }

    #recomSection::-webkit-scrollbar-thumb {
        background: var(--orange);
        border-radius: 4px;
    }

    #recomSection.active {
        display: block;
    }

    /* --- PROGRESS BAR --- */
    .progress-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 5px;
        z-index: 2000;
    }

    .progress-bar {
        height: 100%;
        background: var(--orange);
        width: 0%;
        transition: width 0.2s;
    }

    /* --- CARDS & INPUTS --- */
    .card {
        background: linear-gradient(135deg, #ffffff 0%, var(--light-orange) 100%);
        border-radius: 14px;
        padding: 35px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 760px;
        margin: 0 auto;
    }

    h1,
    h2,
    h3 {
        font-family: 'Playfair Display', serif;
        color: var(--btn-login);
        margin-top: 0;
    }

    h2 {
        border-bottom: 2px solid var(--accent);
        padding-bottom: 8px;
        font-size: 25px;
    }

    p, .p {
        color: #444;
        font-size: 15px;
        line-height: 1.6;
        text-align: justify;
    }

    label {
        font-weight: 600;
        color: #555;
        display: block;
        margin: 15px 0 6px;
        font-size: 14px;
    }

    textarea {
        width: 100%;
        height: 100px;
        padding: 12px;
        border-radius: 8px;
        border: 2px solid #ddd;
        font-size: 14px;
        resize: none;
    }

    textarea:focus {
        border-color: var(--orange);
        outline: none;
    }

    .submit-btn {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        border: none;
        background: linear-gradient(180deg, var(--btn-login), #d1857d);
        color: white;
        font-weight: bold;
        cursor: pointer;
        font-size: 16px;
        margin-top: 15px;
        transition: transform 0.2s;
    }

    .submit-btn:hover {
        transform: translateY(-2px);
    }

    /* --- CUSTOM SELECT --- */
    .custom-hidden {
        display: none;
    }

    .custom-select {
        position: relative;
        margin-bottom: 15px;
        width: 100%;
    }

    .custom-select-trigger {
        background: white;
        padding: 10px 14px;
        border: 2px solid var(--accent);
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .custom-options {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border-radius: 8px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        z-index: 100;
        max-height: 0;
        overflow: hidden;
        transition: 0.3s;
    }

    .custom-select.open .custom-options {
        max-height: 200px;
        overflow-y: auto;
        border: 1px solid #ddd;
    }

    .custom-option {
        padding: 10px 15px;
        cursor: pointer;
        font-size: 14px;
    }

    .custom-option:hover {
        background: #fff1eb;
    }

    /* --- FLOATING BUTTON --- */
    .fab-wrapper {
        position: fixed;
        bottom: 40px;
        right: 45px;
        display: flex;
        align-items: center;
        z-index: 1000;
    }

    .btn-tooltip {
        background: #333;
        color: white;
        padding: 8px 15px;
        border-radius: 20px;
        font-size: 12px;
        margin-right: 15px;
        opacity: 0;
        transition: 0.4s;
    }

    .btn-tooltip.show {
        opacity: 1;
    }

    .floating-btn {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--orange), var(--btn-login));
        border: 3px solid white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 10px 25px rgba(0,0,0,0.3); 
        animation: pulse-orange 2s infinite;
    }

    .floating-btn img {
        width: 28px;
        filter: invert(1);
    }
    @keyframes pulse-orange {
      0% { 
        box-shadow: 0 0 0 0 rgba(246, 160, 121, 0.7); 
      }
      70% { 
        box-shadow: 0 0 0 15px rgba(246, 160, 121, 0); 
      }
      100% { 
        box-shadow: 0 0 0 0 rgba(246, 160, 121, 0); 
      }
    }


    /* --- TAGS & TEXT --- */
    .source-str {
      border-radius: 20px 2px 2px 20px; 
    }
    .source-tag {
      border-radius: 3px;
    }
    .source-end {
      border-radius: 2px 20px 20px 2px;
    }
    .source-tag,  .source-str,  .source-end { 
      font-family: 'Poppins', sans-serif; 
      font-weight: 800; 
      line-height: 1.2;
      display: inline-block; 
      background: var(--orange); 
      color: var(--light);
      padding: 4px 10px;  
      font-size: 11px; 
      margin: 4px; 
    }

    .header-section {
        text-align: center;
        margin-bottom: 30px;
    }

    .recom-page {
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 1px solid #eee;
    }

    .return-btn {
        background: #555;
    }

    /* --- RESPONSIVE --- */
    @media (max-width: 600px) {
        .flex-option {
            grid-template-columns: 1fr;
        }
        #formSection {
            max-width: unset;
            margin: 10px 0;
            padding: 7px;
        }
        .custom-select-trigger {
            padding: 7px 14px;
        }

        .card {
            padding: 20px;
            max-width: none;
        }
        .fab-wrapper {
          bottom: 30px;
          right: 30px;
        }
        .p {
          text-align: unset;
        }

        #recomSection {
            height: 80vh;
            padding-bottom: 80px;
        }
        label {
            font-weight: 600;
            margin: -2px 0 6px;
        }

        .fab-wrapper {
            bottom: 20px;
            right: 20px;
        }
        .submit-btn {
          padding: 11px;
          font-weight: 600;
          margin-top: 0;
      }
        .source-str, .source-tag, .source-end {
        font-size: 9px; 
        border-radius: 3px;
      }
    }
</style>
{% endblock %}

{% block content %}
  <div class="progress-container"><div class="progress-bar" id="myBar"></div></div>

  <div id="formSection" class="active">
    <div class="card">
      <h2>Health & Dietary Profile</h2>
      <p class="p">Fill in the form below to unlock a one time public health recommendations.</p>
      
      <form id="profileForm" method="POST" action="{% url 'recommendation' %}">
            {% csrf_token %}

        <label>List Allergic Ingredients</label>
        <textarea name="allergies" id="allergies" placeholder="Peanuts, Shellfish, etc." ></textarea>
        <div class="flex-option">
          <div>
            <label for="healthCondition">Health Condition</label>
            <select name="health_condition" id="healthCondition"  aria-label="Health Condition">
              <option value="">Select Condition</option>
              <option value="Diabetes">Diabetes (Low Sugar/Carb)</option>
              <option value="Hypertension">Hypertension (Low Sodium)</option>
              <option value="Heart Disease">Heart Disease (Low Cholesterol)</option>
              <option value="Obesity">Obesity / Weight Loss</option>
              <option value="Celiac">Celiac Disease (Gluten-Free)</option>
              <option value="GERD">GERD / Acid Reflux</option>
              <option value="IBS">IBS (Low FODMAP)</option>
              <option value="Kidney Disease">Kidney Disease</option>
              <option value="Gout">Gout (Low Purine)</option>
              <option value="Anemia">Anemia (High Iron)</option>
           </select>
          </div>
          <div>
            <label for="dietary">Dietary Preference</label>
            <select name="dietary" id="dietary" aria-label="Dietary Preference">
              <option value="">Select Preference</option>
              <option value="Vegetarian">Vegetarian (No Meat)</option>
              <option value="Vegan">Vegan (No Animal Products)</option>
              <option value="Pescatarian">Pescatarian (Fish Allowed)</option>
              <option value="Keto">Keto / Low Carb</option>
              <option value="Halal">Halal</option>
              <option value="Kosher">Kosher</option>
              <option value="Gluten-Free">Gluten-Free</option>
              <option value="Dairy-Free">Dairy-Free / Lactose-Free</option>
              <option value="Nut-Free">Nut-Free</option>
              <option value="Shellfish-Free">Shellfish-Free</option>
            </select>
          </div>
        </div>

        <div class="form-button-wrapper">
          <button type="submit" class="submit-btn">Unlock My Health Guide</button>
        </div>
      </form>
    </div>
  </div>

  <div id="recomSection">
    <div class="card">
      <div class="header-section">
        <h1>Public Health Guide</h1>
        <span class="source-str">EVIDENCE-BASED</span><span class="source-tag">WHO</span><span class="source-tag">FAO</span><span class="source-tag">HARVARD HEAILTH</span><span class="source-end">PUBLIC HEALTH</span>
      </div>

      <div class="recom-page">
        <h3>1. Healthy Eating as a Public Health Priority</h3>
        <p>Healthy eating is a major pillar of public health. Poor nutrition is one of the leading risk factors for non-communicable diseases such as diabetes, heart disease, stroke, obesity, and some cancers. Public health nutrition focuses on improving population-wide eating patterns to reduce disease burden, improve life expectancy, and enhance quality of life. Promoting healthy diets helps reduce healthcare costs and supports social and economic development.</p>
      </div>

      <div class="recom-page">
        <h3>2. Nutrition, Prevention, and Disease Control</h3>
        <p>Many diseases can be prevented through proper nutrition. Diets high in salt, sugar, and unhealthy fats increase the risk of hypertension, diabetes, and cardiovascular disease. Conversely, diets rich in fruits, vegetables, whole grains, and healthy fats strengthen immunity and lower disease risk. Public health strategies emphasize prevention rather than treatment.</p>
      </div>

      <div class="recom-page">
        <h3>3. Understanding Food Groups for Population Health</h3>
        <p>A healthy population diet includes diverse food groups: fruits, vegetables, whole grains, proteins, and healthy fats. Each group provides essential nutrients required for growth, energy, immunity, and development. Encouraging dietary diversity helps prevent malnutrition, micronutrient deficiencies, and chronic illness.</p>
      </div>

      <div class="recom-page">
        <h3>4. Carbohydrates and Energy Balance</h3>
        <p>Carbohydrates are essential for energy, especially for children, adolescents, and active individuals. Public health guidelines recommend prioritizing complex carbohydrates such as whole grains, roots, tubers, legumes, fruits, and vegetables. Excess intake of refined carbohydrates and sugary drinks contributes to obesity and type 2 diabetes.</p>
      </div>

      <div class="recom-page">
        <h3>5. Protein Intake and Community Nutrition</h3>
        <p>Proteins support growth, tissue repair, immune defense, and enzyme production. In public health, ensuring adequate protein intake is crucial to prevent stunting and muscle wasting. Affordable protein sources such as beans, lentils, eggs, fish, and nuts play a key role in community nutrition programs.</p>
      </div>

      <div class="recom-page">
        <h3>6. Fats, Heart Health, and Chronic Disease</h3>
        <p>Healthy fats are essential for brain development and hormone regulation. Public health recommendations encourage replacing saturated and trans fats with unsaturated fats found in fish, nuts, seeds, and vegetable oils. Reducing unhealthy fat intake lowers rates of heart disease and stroke at the population level.</p>
      </div>

      <div class="recom-page">
        <h3>7. Micronutrient Deficiencies and Public Health Impact</h3>
        <p>Deficiencies in iron, iodine, vitamin A, and zinc remain major public health concerns, especially in low- and middle-income countries. These deficiencies can cause anemia, impaired immunity, vision problems, and delayed development. Fortified foods and dietary diversification are effective public health interventions.</p>
      </div>

      <div class="recom-page">
        <h3>8. Fruits and Vegetables for Disease Prevention</h3>
        <p>Regular consumption of fruits and vegetables reduces the risk of chronic diseases and improves digestive health. Public health campaigns often promote a minimum daily intake to ensure adequate fiber, vitamins, and antioxidants. Increasing access and affordability is a key public health goal.</p>
      </div>

      <div class="recom-page">
        <h3>9. Salt Reduction and Blood Pressure Control</h3>
        <p>High salt intake is a major contributor to hypertension and cardiovascular disease. Public health authorities recommend limiting salt consumption by reducing processed foods and avoiding excessive seasoning. Community education and food labeling policies help reduce population salt intake.</p>
      </div>

      <div class="recom-page">
        <h3>10. Sugar Reduction and Metabolic Health</h3>
        <p>Excessive sugar intake, particularly from sugary beverages, is linked to obesity, diabetes, and dental problems. Public health strategies include promoting water consumption, limiting sweetened drinks, and educating communities on reading food labels.</p>
      </div>

      <div class="recom-page">
        <h3>11. Processed Foods and Health Risks</h3>
        <p>Highly processed foods are often energy-dense and nutrient-poor. Regular consumption increases the risk of obesity and metabolic disorders. Public health messaging encourages fresh, minimally processed foods prepared at home using local ingredients.</p>
      </div>

      <div class="recom-page">
        <h3>12. Food Safety, Hygiene, and Disease Prevention</h3>
        <p>Foodborne illnesses are a significant public health issue. Proper handwashing, clean water use, adequate cooking, and safe food storage prevent infections. Public education on food hygiene reduces outbreaks and protects vulnerable populations.</p>
      </div>

      <div class="recom-page">
        <h3>13. Nutrition Across the Life Course</h3>
        <p>Public health nutrition addresses the needs of all age groups. Children require nutrients for growth, adults need balanced diets for productivity, and older adults benefit from nutrient-dense foods to prevent chronic disease and frailty. Tailored nutrition policies improve outcomes at each life stage.</p>
      </div>

      <div class="recom-page">
        <h3>14. Maternal and Child Nutrition</h3>
        <p>Maternal nutrition affects pregnancy outcomes and child development. Adequate intake of iron, folate, calcium, and protein reduces maternal mortality and low birth weight. Breastfeeding promotion is a key public health strategy for infant health.</p>
      </div>

      <div class="recom-page">
        <h3>15. Adolescents, Schools, and Healthy Diets</h3>
        <p>Adolescence is a critical period for establishing lifelong habits. School feeding programs and nutrition education help prevent malnutrition and obesity. Healthy school environments support learning, concentration, and physical development.</p>
      </div>

      <div class="recom-page">
        <h3>16. Nutrition, Physical Activity, and Lifestyle</h3>
        <p>Healthy eating works best when combined with regular physical activity. Public health guidelines recommend daily movement alongside balanced diets to prevent obesity and improve mental health. Community spaces and active transport support healthier lifestyles.</p>
      </div>

      <div class="recom-page">
        <h3>17. Cultural, Local, and Sustainable Diets</h3>
        <p>Public health nutrition respects cultural food practices while promoting balance and moderation. Local and traditional foods often provide excellent nutrition when prepared healthily. Sustainable diets support environmental protection and long-term food security.</p>
      </div>

      <div class="recom-page">
        <h3>18. Addressing Malnutrition in All Its Forms</h3>
        <p>Malnutrition includes undernutrition, micronutrient deficiencies, overweight, and obesity. Public health interventions must address all forms simultaneously through education, food access, and policy regulation.</p>
      </div>

      <div class="recom-page">
        <h3>19. Community Education and Policy Interventions</h3>
        <p>Public health awareness relies on education campaigns, food labeling, taxation of unhealthy products, and support for local agriculture. Policies that promote healthy food environments lead to better population health outcomes.</p>
      </div>

      <div class="recom-page">
        <h3>20. Conclusion: Building Healthier Populations Through Nutrition</h3>
        <p>Healthy eating is a shared responsibility involving individuals, communities, governments, and health systems. Public health nutrition focuses on prevention, equity, and sustainability. By improving diets at the population level, societies can reduce disease, improve productivity, and enhance overall well-being.</p>
      </div>


      <button class="submit-btn return-btn" onclick="toggleView()">Return to Profile</button>
    </div>
  </div>

  <div class="fab-wrapper">
    <div class="btn-tooltip" id="guideTooltip">Quick Access Guide</div>
    <div class="floating-btn" onclick="toggleView()">
      <img src="{% static 'users/icons/recommend.png' %}" alt="Icon">
    </div>
  </div>
  
  {% endblock %}
  
  {% block extra_js %}

  <script>
    // Toggle Logic
    function toggleView() {
      const form = document.getElementById('formSection');
      const recom = document.getElementById('recomSection');
      const tooltip = document.getElementById('guideTooltip');
      
      tooltip.classList.remove('show');

      if (form.classList.contains('active')) {
        form.classList.remove('active');
        recom.classList.add('active');
        recom.scrollTop = 0; 
      } else {
        recom.classList.remove('active');
        form.classList.add('active');
      }
    }

    // Scroll Progress Indicator Logic
    document.getElementById('recomSection').onscroll = function() {
      const winScroll = document.getElementById('recomSection').scrollTop;
      const height = document.getElementById('recomSection').scrollHeight - document.getElementById('recomSection').clientHeight;
      const scrolled = (winScroll / height) * 100;
      document.getElementById("myBar").style.width = scrolled + "%";
    };

    // Custom Select Initializer
    function initCustomSelects() {
      document.querySelectorAll('select').forEach(sel => {
        sel.classList.add('custom-hidden');
        const wrap = document.createElement('div');
        wrap.className = 'custom-select';
        const trig = document.createElement('div');
        trig.className = 'custom-select-trigger';
        trig.innerHTML = `<span>${sel.options[sel.selectedIndex].text}</span><span>&#x25BE;</span>`;
        const opts = document.createElement('div');
        opts.className = 'custom-options';

        Array.from(sel.options).forEach(opt => {
          const item = document.createElement('div');
          item.className = 'custom-option';
          item.textContent = opt.text;
          item.onclick = () => {
            sel.value = opt.value;
            trig.firstElementChild.textContent = opt.text;
            wrap.classList.remove('open');
            sel.dispatchEvent(new Event('change'));
          };
          opts.appendChild(item);
        });

        trig.onclick = (e) => {
          e.stopPropagation();
          document.querySelectorAll('.custom-select').forEach(s => s !== wrap && s.classList.remove('open'));
          wrap.classList.toggle('open');
        };

        wrap.appendChild(trig);
        wrap.appendChild(opts);
        sel.parentNode.insertBefore(wrap, sel.nextSibling);
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      initCustomSelects();
      setTimeout(() => document.getElementById('guideTooltip').classList.add('show'), 3000);
    });

    window.onclick = () => document.querySelectorAll('.custom-select').forEach(s => s.classList.remove('open'));

    
  </script>
{% endblock %}